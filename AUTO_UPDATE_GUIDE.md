# Auto-Update System Guide

## ‚úÖ Auto-Updates Now Configured!

Your Sentra app will now automatically check for updates and notify users when new versions are available.

---

## üîÑ How Auto-Updates Work

### When Updates Check Happens
- **At App Launch**: 5 seconds after the app starts (only in production builds)
- **Only for Packaged Apps**: Auto-update does not run in development mode

### Update Flow
1. **App starts** ‚Üí Waits 5 seconds ‚Üí **Checks GitHub releases**
2. **If new version found**:
   - Shows dialog: "A new version X.X.X is available. Download now?"
   - User clicks "Download" ‚Üí Downloads update in background
   - Shows progress in console
3. **When download complete**:
   - Shows dialog: "Update ready. Restart to install?"
   - User clicks "Restart Now" ‚Üí App closes and installs update automatically

### Example Scenario
```
You have v1.0.14 installed
You release v1.0.15 on GitHub
User opens app ‚Üí 5 seconds later ‚Üí Dialog appears:
  "A new version 1.0.15 is available. Would you like to download it now?"
```

---

## üì¶ How to Release Updates

### 1. Update Version Number
Edit `frontend/package.json`:
```json
{
  "version": "1.0.15"  ‚Üê Change this
}
```

### 2. Commit and Push Changes
```bash
git add -A
git commit -m "Bump version to 1.0.15 - [describe changes]"
git push origin main
```

### 3. Create and Push Git Tag
```bash
git tag v1.0.15 -m "Release v1.0.15 - [describe changes]"
git push origin v1.0.15
```

### 4. GitHub Actions Builds Automatically
- Workflow triggers on tag push
- Builds installer with new version
- Publishes to GitHub Releases
- Generates `latest.yml` file (used by auto-updater)

### 5. Users Get Update Automatically
- Next time users open v1.0.14 app
- App checks GitHub and finds v1.0.15
- User gets notification to update

---

## üîë What Files Are Used

### For Auto-Updater to Work:
1. **Installer EXE**: `Sentra Setup 1.0.15.exe` (users download this)
2. **latest.yml**: Auto-generated by electron-builder
   - Contains version info and download URL
   - Located in GitHub Release assets
   - Auto-updater reads this file to check for updates

### latest.yml Example:
```yaml
version: 1.0.15
files:
  - url: Sentra Setup 1.0.15.exe
    sha512: [hash]
    size: 123456789
path: Sentra Setup 1.0.15.exe
sha512: [hash]
releaseDate: '2025-11-14T06:30:00.000Z'
```

---

## ‚ùì FAQ

### Q: Will users on v1.0.14 automatically update to v1.0.15?
**A: Yes!** When they open the app, it will:
1. Check for updates (5 sec after launch)
2. Find v1.0.15 available
3. Show dialog asking to download
4. Download in background
5. Prompt to restart and install

### Q: Do updates install without user permission?
**A: No!** The app will:
- Ask permission to **download** the update
- Ask permission to **restart and install** the update
- User can click "Later" at any time

### Q: How long does the update take?
- **Check for update**: 1-2 seconds
- **Download update**: Depends on internet speed (installer is ~150MB)
- **Install update**: Automatic when user clicks "Restart Now"

### Q: Can I force update immediately?
**A: Yes!** Modify this line in `main.cjs`:
```javascript
autoUpdater.autoDownload = true;  // Auto-downloads without asking
autoUpdater.autoInstallOnAppQuit = true;  // Auto-installs on quit
```

### Q: What if update check fails (no internet)?
**A: Nothing happens.** The app continues working normally. Will try again next time app opens.

---

## üõ†Ô∏è Testing Auto-Updates

### Test on Your Machine:
1. Build and install v1.0.14:
   ```bash
   npm run build-electron-win
   ```
   Install the generated EXE

2. Bump version to v1.0.15 in package.json

3. Build and publish v1.0.15 to GitHub:
   ```bash
   git tag v1.0.15 -m "Test update"
   git push origin v1.0.15
   ```

4. Wait for GitHub Actions to finish building

5. Open your installed v1.0.14 app

6. After 5 seconds, you should see update notification!

---

## üöÄ Production Checklist

When releasing new version:
- [ ] Update version in `frontend/package.json`
- [ ] Update CHANGELOG or release notes
- [ ] Commit changes
- [ ] Create git tag with `v` prefix (e.g., `v1.0.15`)
- [ ] Push tag to GitHub
- [ ] Wait for GitHub Actions build to complete
- [ ] Verify release appears on GitHub Releases page
- [ ] Verify `latest.yml` exists in release assets
- [ ] Test update notification on older app version

---

## üìù Console Logs

When auto-update runs, you'll see these logs:

```
[UPDATE] Checking for updates...
[UPDATE] Update available: 1.0.15
[UPDATE] Downloaded 25.50% (38000000/149000000)
[UPDATE] Downloaded 50.00% (75000000/149000000)
[UPDATE] Downloaded 100.00% (149000000/149000000)
[UPDATE] Update downloaded: 1.0.15
```

---

## üêõ Troubleshooting

### Auto-update not working?
1. **Check you're running packaged app** (not dev mode)
2. **Check internet connection**
3. **Check GitHub release exists** with `latest.yml` file
4. **Check console logs** for error messages
5. **Verify version in package.json** matches git tag

### Users not seeing update?
- Ensure they're running **packaged version** (not dev)
- Check their **app version** vs GitHub latest release
- Verify **latest.yml** exists in release assets
- Check if firewall is blocking GitHub API

---

## üéØ Summary

‚úÖ **Auto-updates configured** in `main.cjs`  
‚úÖ **GitHub publishing configured** in `package.json`  
‚úÖ **Updates check automatically** 5 seconds after app start  
‚úÖ **Users control when to install** (not forced)  
‚úÖ **Works with your existing CI/CD** (GitHub Actions)

**Next time you release**: Just bump version and push a git tag. GitHub Actions handles the rest!
